<!DOCTYPE html>
<html lang="uz" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>OpenClaw v4</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
  <style>
    /* â”€â”€â”€ TOKENS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    :root {
      --green:  #10b981;
      --red:    #f43f5e;
      --amber:  #f59e0b;
      --blue:   #3b82f6;
      --purple: #8b5cf6;
    }
    [data-theme="dark"] {
      --bg:        #080c14;
      --bg1:       #0d1421;
      --bg2:       #111827;
      --surface:   #131d2e;
      --surface2:  #1a2540;
      --border:    #1e2d42;
      --border2:   #253650;
      --text:      #e8eef7;
      --text2:     #7b90b0;
      --text3:     #3d5170;
      --accent:    #2dd4bf;
      --accent2:   #0f766e;
    }
    [data-theme="light"] {
      --bg:        #f0f4fb;
      --bg1:       #e8eef8;
      --bg2:       #dde5f5;
      --surface:   #ffffff;
      --surface2:  #f5f8ff;
      --border:    #dce5f0;
      --border2:   #c8d5e8;
      --text:      #0d1421;
      --text2:     #4a6080;
      --text3:     #9ab0cc;
      --accent:    #0d9488;
      --accent2:   #ccfbf1;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      min-height: 100vh;
      overflow-x: hidden;
      transition: background .25s, color .25s;
    }

    /* subtle grid */
    body::before {
      content: '';
      position: fixed; inset: 0;
      background-image: radial-gradient(circle at 20% 20%, rgba(45,212,191,.04) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(59,130,246,.03) 0%, transparent 50%);
      pointer-events: none; z-index: 0;
    }

    .wrap { position: relative; z-index: 1; max-width: 480px; margin: 0 auto; padding: 16px 14px 32px; }

    /* â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 20px;
    }
    .brand { display: flex; align-items: baseline; gap: 6px; }
    .brand-name {
      font-family: 'Playfair Display', serif;
      font-size: 18px; font-weight: 600;
      background: linear-gradient(135deg, var(--accent) 0%, #60a5fa 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .brand-ver {
      font-size: 10px; font-weight: 500;
      color: var(--text3); letter-spacing: .06em;
      border: 1px solid var(--border); border-radius: 4px;
      padding: 1px 5px;
    }
    .header-actions { display: flex; align-items: center; gap: 6px; }

    .ico-btn {
      width: 30px; height: 30px; border-radius: 8px;
      border: 1px solid var(--border); background: var(--surface);
      color: var(--text2); cursor: pointer; font-size: 13px;
      display: flex; align-items: center; justify-content: center;
      transition: all .15s;
    }
    .ico-btn:hover { border-color: var(--border2); color: var(--text); }

    .badge {
      height: 28px; padding: 0 10px; border-radius: 7px;
      border: 1px solid var(--border); background: var(--surface);
      color: var(--text3); font-size: 10px; font-weight: 600;
      display: flex; align-items: center; gap: 5px;
      cursor: pointer; transition: all .15s;
      letter-spacing: .05em; text-transform: uppercase;
    }
    .badge.on  { border-color: var(--green); color: var(--green); background: rgba(16,185,129,.08); }
    .badge.real{ border-color: var(--green); color: var(--green); background: rgba(16,185,129,.08); }
    .badge-dot { width: 5px; height: 5px; border-radius: 50%; background: currentColor; }
    .badge.on .badge-dot { animation: pulse 2s ease-in-out infinite; }
    @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.3;transform:scale(.6)} }

    /* â”€â”€â”€ PORTFOLIO CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .port-card {
      background: linear-gradient(145deg, var(--surface) 0%, var(--surface2) 100%);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 18px 18px 14px;
      margin-bottom: 10px;
      position: relative;
      overflow: hidden;
    }
    .port-card::after {
      content: '';
      position: absolute; top: -30px; right: -30px;
      width: 120px; height: 120px;
      background: radial-gradient(circle, rgba(45,212,191,.08) 0%, transparent 70%);
      pointer-events: none;
    }
    .port-label {
      font-size: 10px; font-weight: 500; text-transform: uppercase;
      letter-spacing: .1em; color: var(--text3); margin-bottom: 6px;
    }
    .port-value {
      font-family: 'DM Mono', monospace;
      font-size: 32px; font-weight: 500; letter-spacing: -.5px;
      color: var(--text); line-height: 1; margin-bottom: 10px;
    }
    .port-row { display: flex; gap: 16px; align-items: center; }
    .port-meta { font-size: 11px; color: var(--text3); }
    .port-meta b { color: var(--text2); font-weight: 500; }
    .port-pnl {
      margin-left: auto;
      font-family: 'DM Mono', monospace;
      font-size: 13px; font-weight: 500;
      padding: 3px 9px; border-radius: 6px;
    }
    .port-pnl.up  { color: var(--green); background: rgba(16,185,129,.1); }
    .port-pnl.dn  { color: var(--red);   background: rgba(244,63,94,.1); }
    .port-pnl.neu { color: var(--text3); background: var(--surface2); }

    /* â”€â”€â”€ SCAN BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .scan-row {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 14px;
      margin-bottom: 10px;
      display: flex; align-items: center; gap: 10px;
    }
    .scan-orb {
      position: relative; width: 32px; height: 32px; flex-shrink: 0;
    }
    .scan-orb-inner {
      width: 32px; height: 32px; border-radius: 50%;
      background: rgba(45,212,191,.1);
      border: 1px solid rgba(45,212,191,.2);
      display: flex; align-items: center; justify-content: center;
      font-size: 14px;
      transition: all .3s;
    }
    .scan-orb-inner.pulsing {
      animation: orb 2.4s ease-in-out infinite;
    }
    @keyframes orb {
      0%,100%{background:rgba(45,212,191,.1);border-color:rgba(45,212,191,.2);box-shadow:none}
      50%{background:rgba(45,212,191,.2);border-color:rgba(45,212,191,.5);box-shadow:0 0 12px rgba(45,212,191,.3)}
    }
    .scan-info { flex: 1; min-width: 0; }
    .scan-title { font-size: 12px; font-weight: 500; color: var(--text); }
    .scan-sub   { font-size: 10px; color: var(--text3); margin-top: 1px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .scan-wave  { display: flex; align-items: center; gap: 2px; height: 16px; }
    .scan-wave span {
      display: inline-block; width: 2px; border-radius: 1px;
      background: var(--accent); animation: wave 1s ease-in-out infinite;
    }
    .scan-wave span:nth-child(1){height:4px;animation-delay:0s}
    .scan-wave span:nth-child(2){height:10px;animation-delay:.1s}
    .scan-wave span:nth-child(3){height:7px;animation-delay:.2s}
    .scan-wave span:nth-child(4){height:13px;animation-delay:.3s}
    .scan-wave span:nth-child(5){height:5px;animation-delay:.4s}
    @keyframes wave{0%,100%{opacity:.3;transform:scaleY(.5)}50%{opacity:1;transform:scaleY(1)}}

    /* â”€â”€â”€ METRICS ROW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .metrics {
      display: grid; grid-template-columns: repeat(4,1fr); gap: 6px;
      margin-bottom: 10px;
    }
    .metric {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 8px;
      text-align: center;
    }
    .metric-val {
      font-family: 'DM Mono', monospace;
      font-size: 16px; font-weight: 500; color: var(--text);
      line-height: 1; margin-bottom: 3px;
    }
    .metric-val.g { color: var(--green); }
    .metric-val.r { color: var(--red); }
    .metric-val.b { color: var(--blue); }
    .metric-val.a { color: var(--accent); }
    .metric-lbl { font-size: 9px; text-transform: uppercase; letter-spacing: .08em; color: var(--text3); }

    /* â”€â”€â”€ ACTION BTN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .action-btn {
      width: 100%; height: 44px;
      border-radius: 12px; border: none;
      font-family: 'DM Sans', sans-serif;
      font-size: 13px; font-weight: 600;
      cursor: pointer; transition: all .15s;
      margin-bottom: 10px; letter-spacing: .01em;
    }
    .action-btn.go {
      background: linear-gradient(135deg, var(--accent) 0%, #0891b2 100%);
      color: #fff;
      box-shadow: 0 4px 20px rgba(45,212,191,.2);
    }
    .action-btn.go:hover { transform: translateY(-1px); box-shadow: 0 6px 24px rgba(45,212,191,.3); }
    .action-btn.halt {
      background: rgba(244,63,94,.08);
      color: var(--red);
      border: 1px solid rgba(244,63,94,.2);
    }
    .action-btn.halt:hover { background: rgba(244,63,94,.14); }

    /* â”€â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .tabs {
      display: grid; grid-template-columns: repeat(5,1fr);
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 10px; padding: 3px; gap: 2px; margin-bottom: 10px;
    }
    .tab {
      padding: 7px 2px; border-radius: 7px; border: none;
      background: transparent; color: var(--text3);
      font-family: 'DM Sans', sans-serif; font-size: 9px;
      font-weight: 600; cursor: pointer; transition: all .15s;
      text-transform: uppercase; letter-spacing: .04em;
    }
    .tab.active {
      background: var(--surface2); color: var(--text);
      border: 1px solid var(--border2);
    }
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    /* â”€â”€â”€ SECTION TITLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .sec {
      font-size: 9px; font-weight: 600; text-transform: uppercase;
      letter-spacing: .1em; color: var(--text3);
      margin-bottom: 8px; display: flex; align-items: center; gap: 8px;
    }
    .sec::after { content:''; flex:1; height:1px; background:var(--border); }
    .sec-cnt {
      font-family: 'DM Mono', monospace; font-size: 9px;
      color: var(--accent); background: rgba(45,212,191,.08);
      padding: 1px 6px; border-radius: 4px; border: 1px solid rgba(45,212,191,.15);
    }

    /* â”€â”€â”€ TOTAL BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .total-bar {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 10px; padding: 11px 14px; margin-bottom: 8px;
      display: flex; justify-content: space-between; align-items: center;
    }
    .total-left { font-size: 10px; color: var(--text3); }
    .total-left strong { display: block; font-size: 12px; font-weight: 500; color: var(--text2); margin-bottom: 1px; }
    .total-right { text-align: right; }
    .total-pct {
      font-family: 'DM Mono', monospace; font-size: 20px; font-weight: 500; display: block;
    }
    .total-usd {
      font-family: 'DM Mono', monospace; font-size: 11px; color: var(--text3);
    }
    .total-pct.g,.total-usd.g { color: var(--green); }
    .total-pct.r,.total-usd.r { color: var(--red); }

    /* â”€â”€â”€ POSITION CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .pos-card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 12px; padding: 12px 14px; margin-bottom: 7px;
      transition: border-color .15s;
    }
    .pos-card:hover { border-color: var(--border2); }
    .pos-head { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
    .pos-sym { font-size: 13px; font-weight: 600; color: var(--text); flex: 1; }
    .pos-sym small { display: block; font-size: 9px; font-weight: 400; color: var(--text3); margin-top: 1px; }
    .pnl-chip {
      font-family: 'DM Mono', monospace; font-size: 12px; font-weight: 500;
      padding: 3px 9px; border-radius: 6px;
    }
    .pnl-chip.g { color: var(--green); background: rgba(16,185,129,.1); }
    .pnl-chip.r { color: var(--red);   background: rgba(244,63,94,.1); }
    .pnl-usd {
      font-family: 'DM Mono', monospace; font-size: 10px;
    }
    .pnl-usd.g { color: var(--green); }
    .pnl-usd.r { color: var(--red); }
    .x-btn {
      width: 26px; height: 26px; border-radius: 7px;
      border: 1px solid var(--border2); background: transparent;
      color: var(--text3); cursor: pointer; font-size: 11px;
      display: flex; align-items: center; justify-content: center;
      transition: all .15s; flex-shrink: 0;
    }
    .x-btn:hover { border-color: var(--red); color: var(--red); background: rgba(244,63,94,.08); }
    .pos-grid {
      display: grid; grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 4px; margin-bottom: 7px;
    }
    .pg { text-align: center; }
    .pg-lbl { font-size: 8px; text-transform: uppercase; letter-spacing: .06em; color: var(--text3); }
    .pg-val { font-family: 'DM Mono', monospace; font-size: 10px; font-weight: 500; color: var(--text2); }
    .pg-val.g { color: var(--green); }
    .pg-val.r { color: var(--red); }
    .track { height: 3px; border-radius: 2px; background: var(--border); overflow: hidden; }
    .track-fill { height: 100%; border-radius: 2px; transition: width .8s cubic-bezier(.4,0,.2,1); }

    /* â”€â”€â”€ CLOSE ALL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .close-all-btn {
      width: 100%; padding: 10px; border-radius: 9px;
      border: 1px solid rgba(244,63,94,.25);
      background: rgba(244,63,94,.05);
      color: var(--red); font-family: 'DM Sans', sans-serif;
      font-size: 11px; font-weight: 600; cursor: pointer;
      transition: all .15s; margin-top: 4px; margin-bottom: 8px;
      letter-spacing: .02em;
    }
    .close-all-btn:hover { background: rgba(244,63,94,.12); border-color: rgba(244,63,94,.4); }

    /* â”€â”€â”€ SIGNAL ITEM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .sig-item {
      display: flex; align-items: center; gap: 10px;
      padding: 9px 12px; background: var(--surface);
      border: 1px solid var(--border); border-radius: 10px; margin-bottom: 5px;
    }
    .sig-led { width: 6px; height: 6px; border-radius: 50%; background: var(--accent); flex-shrink: 0; }
    .sig-sym { font-size: 12px; font-weight: 500; color: var(--text); flex: 1; }
    .sig-time { font-size: 9px; color: var(--text3); }
    .sig-score {
      font-family: 'DM Mono', monospace; font-size: 10px; font-weight: 500;
      padding: 2px 7px; border-radius: 5px;
      background: rgba(45,212,191,.08); color: var(--accent);
      border: 1px solid rgba(45,212,191,.15);
    }

    /* â”€â”€â”€ HISTORY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .hist-item {
      display: flex; align-items: flex-start; gap: 10px;
      padding: 10px 0; border-bottom: 1px solid var(--border);
    }
    .hist-item:last-child { border-bottom: none; }
    .hist-led { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; margin-top: 4px; }
    .hist-led.g { background: var(--green); }
    .hist-led.r { background: var(--red); }
    .hist-info { flex: 1; }
    .hist-sym { font-size: 12px; font-weight: 500; color: var(--text); }
    .hist-meta { font-size: 9px; color: var(--text3); margin-top: 2px; }
    .hist-prices { font-family: 'DM Mono', monospace; font-size: 9px; color: var(--text3); margin-top: 2px; }
    .hist-right { text-align: right; }
    .hist-pct {
      font-family: 'DM Mono', monospace; font-size: 13px; font-weight: 500;
    }
    .hist-pct.g { color: var(--green); }
    .hist-pct.r { color: var(--red); }
    .hist-usd {
      font-family: 'DM Mono', monospace; font-size: 10px;
      margin-top: 1px;
    }
    .hist-usd.g { color: var(--green); }
    .hist-usd.r { color: var(--red); }

    /* â”€â”€â”€ AUTO FIXES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .fix-item {
      background: var(--surface); border: 1px solid var(--border);
      border-left: 3px solid var(--purple);
      border-radius: 10px; padding: 10px 12px; margin-bottom: 6px;
    }
    .fix-time { font-size: 9px; color: var(--text3); margin-bottom: 4px; }
    .fix-type {
      display: inline-block; font-size: 9px; font-weight: 600;
      text-transform: uppercase; letter-spacing: .06em;
      background: rgba(139,92,246,.12); color: var(--purple);
      border: 1px solid rgba(139,92,246,.2);
      padding: 1px 6px; border-radius: 4px; margin-bottom: 4px;
    }
    .fix-desc { font-size: 11px; color: var(--text2); line-height: 1.5; }

    /* â”€â”€â”€ SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 7px; margin-bottom: 8px; }
    .sbox {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 10px; padding: 11px 12px;
    }
    .sbox-lbl { font-size: 9px; text-transform: uppercase; letter-spacing: .08em; color: var(--text3); margin-bottom: 5px; }
    .sbox-input {
      width: 100%; background: transparent; border: none;
      border-bottom: 1px solid var(--border2);
      color: var(--text); font-family: 'DM Mono', monospace;
      font-size: 16px; font-weight: 400; padding-bottom: 2px; outline: none;
    }
    .sbox-input:focus { border-color: var(--accent); }
    .sbox-unit { font-size: 9px; color: var(--text3); margin-top: 3px; }
    .save-btn {
      width: 100%; padding: 11px; border-radius: 10px;
      border: 1px solid var(--border2); background: var(--surface);
      color: var(--text2); font-family: 'DM Sans', sans-serif;
      font-size: 12px; font-weight: 500; cursor: pointer;
      transition: all .15s; margin-bottom: 10px;
    }
    .save-btn:hover { border-color: var(--accent); color: var(--accent); }

    /* â”€â”€â”€ CHIPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .chips { display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 10px; }
    .chip {
      padding: 3px 9px; border-radius: 5px; font-size: 9px; font-weight: 600;
      border: 1px solid var(--border); color: var(--text3); letter-spacing: .03em;
    }
    .chip.on {
      border-color: rgba(45,212,191,.3); color: var(--accent);
      background: rgba(45,212,191,.06);
    }

    /* â”€â”€â”€ LOG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .log-wrap {
      background: var(--bg1); border: 1px solid var(--border);
      border-radius: 10px; padding: 10px 12px; height: 110px;
      overflow-y: auto; font-family: 'DM Mono', monospace;
      font-size: 10px; color: var(--text3);
    }
    .log-line { margin-bottom: 2px; line-height: 1.6; }
    .log-line.fresh { color: var(--accent); }

    /* â”€â”€â”€ EMPTY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .empty { text-align: center; padding: 28px 0; color: var(--text3); font-size: 11px; }
    .empty svg { display: block; margin: 0 auto 8px; opacity: .3; }

    ::-webkit-scrollbar { width: 2px; }
    ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }
  </style>
</head>
<body>
<div class="wrap">

  <!-- HEADER -->
  <div class="header">
    <div class="brand">
      <span class="brand-name">OpenClaw</span>
      <span class="brand-ver">v4</span>
    </div>
    <div class="header-actions">
      <button class="ico-btn" id="theme-btn" onclick="toggleTheme()">â˜€ï¸</button>
      <div id="dry-badge" class="badge" onclick="toggleDry()">
        <span class="badge-dot"></span>DRY
      </div>
      <div id="status-badge" class="badge">
        <span class="badge-dot"></span>
        <span id="status-txt">off</span>
      </div>
    </div>
  </div>

  <!-- PORTFOLIO CARD -->
  <div class="port-card">
    <div class="port-label">Portfolio Â· USDT</div>
    <div class="port-value" id="balance">$0.00</div>
    <div class="port-row">
      <div class="port-meta"><span id="open-cnt">0</span> <b>ochiq</b></div>
      <div class="port-meta"><span id="coin-cnt">0</span> <b>coin</b></div>
      <div class="port-meta" id="upd-time">--:--</div>
      <div class="port-pnl neu" id="port-pnl">0%</div>
    </div>
  </div>

  <!-- SCAN BAR -->
  <div class="scan-row">
    <div class="scan-orb">
      <div class="scan-orb-inner" id="scan-orb">â¸</div>
    </div>
    <div class="scan-info">
      <div class="scan-title" id="scan-t">Kutish rejimi</div>
      <div class="scan-sub"  id="scan-s">Trading o'chirilgan</div>
    </div>
    <div class="scan-wave" id="scan-wave" style="display:none">
      <span></span><span></span><span></span><span></span><span></span>
    </div>
  </div>

  <!-- METRICS -->
  <div class="metrics">
    <div class="metric">
      <div class="metric-val a" id="mt-trades">0</div>
      <div class="metric-lbl">Trades</div>
    </div>
    <div class="metric">
      <div class="metric-val g" id="mt-wins">0</div>
      <div class="metric-lbl">Win</div>
    </div>
    <div class="metric">
      <div class="metric-val r" id="mt-loss">0</div>
      <div class="metric-lbl">Lose</div>
    </div>
    <div class="metric">
      <div class="metric-val" id="mt-pnl">0%</div>
      <div class="metric-lbl">PnL</div>
    </div>
  </div>

  <!-- ACTION BUTTON -->
  <button id="action-btn" class="action-btn go" onclick="toggleTrading()">
    Tradingni Yoqish
  </button>

  <!-- TABS -->
  <div class="tabs">
    <button class="tab active" onclick="showTab('pos',this)">Pozitsiya</button>
    <button class="tab" onclick="showTab('signals',this)">Signal</button>
    <button class="tab" onclick="showTab('history',this)">Tarix</button>
    <button class="tab" onclick="showTab('fixes',this)">AI Fixes</button>
    <button class="tab" onclick="showTab('settings',this)">Sozlama</button>
  </div>

  <!-- POSITIONS -->
  <div id="tab-pos" class="tab-panel active">
    <div id="pos-total" class="total-bar" style="display:none">
      <div class="total-left">
        <strong id="pos-total-lbl">Umumiy PnL</strong>
        barcha pozitsiyalar
      </div>
      <div class="total-right">
        <span class="total-pct" id="pos-total-pct">0%</span>
        <span class="total-usd" id="pos-total-usd">$0.00</span>
      </div>
    </div>
    <div class="sec">Ochiq pozitsiyalar <span class="sec-cnt" id="pos-count">0</span></div>
    <div id="pos-list"><div class="empty">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
      Ochiq pozitsiya yo'q
    </div></div>
    <button class="close-all-btn" id="close-all-btn" onclick="closeAll()" style="display:none">
      âœ• Hammasini yopish
    </button>
  </div>

  <!-- SIGNALS -->
  <div id="tab-signals" class="tab-panel">
    <div class="sec">Aniqlangan signallar</div>
    <div id="sig-list"><div class="empty">Signal kutilmoqda...</div></div>
  </div>

  <!-- HISTORY -->
  <div id="tab-history" class="tab-panel">
    <div id="hist-total" class="total-bar" style="display:none">
      <div class="total-left">
        <strong id="hist-cnt">0 trade</strong>
        umumiy natija
      </div>
      <div class="total-right">
        <span class="total-pct" id="hist-pct">0%</span>
        <span class="total-usd" id="hist-usd">$0.00</span>
      </div>
    </div>
    <div class="sec">Trades tarixi</div>
    <div id="hist-list"><div class="empty">Hali trade yo'q</div></div>
  </div>

  <!-- AI FIXES -->
  <div id="tab-fixes" class="tab-panel">
    <div class="sec">Bot o'zi to'g'irlagan xatolar</div>
    <div id="fixes-list"><div class="empty">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
      Hali avtomatik to'g'irlash yo'q
    </div></div>
  </div>

  <!-- SETTINGS -->
  <div id="tab-settings" class="tab-panel">
    <div class="sec">Savdo parametrlari</div>
    <div class="settings-grid">
      <div class="sbox">
        <div class="sbox-lbl">Take Profit</div>
        <input class="sbox-input" id="tp-in" type="number" step="0.1" min="0.1" value="3.0">
        <div class="sbox-unit">% foiz</div>
      </div>
      <div class="sbox">
        <div class="sbox-lbl">Stop Loss</div>
        <input class="sbox-input" id="sl-in" type="number" step="0.1" min="0.1" value="1.5">
        <div class="sbox-unit">% foiz</div>
      </div>
      <div class="sbox">
        <div class="sbox-lbl">Savdo summasi</div>
        <input class="sbox-input" id="amt-in" type="number" step="1" min="5" value="10">
        <div class="sbox-unit">USDT</div>
      </div>
      <div class="sbox">
        <div class="sbox-lbl">Max pozitsiya</div>
        <input class="sbox-input" id="maxpos-in" type="number" step="1" min="1" max="30" value="10">
        <div class="sbox-unit">ta bir vaqtda</div>
      </div>
    </div>
    <button class="save-btn" onclick="saveParams()">Saqlash</button>

    <div class="sec">Coinlar</div>
    <div class="chips" id="sym-chips"></div>

    <div class="sec">Log</div>
    <div class="log-wrap" id="log-box">Ulanmoqda...</div>
  </div>

</div>
<script>
const API = (location.origin.includes('ngrok')||location.origin.includes('localhost'))
  ? location.origin+'/api'
  : 'https://orville-diclinous-unpolemically.ngrok-free.dev/api';
const H = {'ngrok-skip-browser-warning':'true'};
const get  = p => fetch(API+p,{headers:H}).then(r=>r.json()).catch(()=>null);
const post = (p,b) => fetch(API+p,{method:'POST',headers:{...H,'Content-Type':'application/json'},body:JSON.stringify(b)}).then(r=>r.json()).catch(()=>null);

let theme = localStorage.getItem('oc-theme')||'dark';
let editing = false;

document.documentElement.setAttribute('data-theme',theme);
document.getElementById('theme-btn').textContent = theme==='dark'?'â˜€ï¸':'ğŸŒ™';

function toggleTheme(){
  theme = theme==='dark'?'light':'dark';
  document.documentElement.setAttribute('data-theme',theme);
  document.getElementById('theme-btn').textContent = theme==='dark'?'â˜€ï¸':'ğŸŒ™';
  localStorage.setItem('oc-theme',theme);
}

function showTab(name,el){
  document.querySelectorAll('.tab-panel').forEach(e=>e.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(e=>e.classList.remove('active'));
  document.getElementById('tab-'+name).classList.add('active');
  el.classList.add('active');
  if(name==='history') loadHistory();
  if(name==='fixes') loadFixes();
}

async function toggleTrading(){ await get('/toggle_trading'); update(); }
async function toggleDry(){ await get('/toggle_dry'); update(); }

async function saveParams(){
  await Promise.all([
    post('/set_tp',     {value:parseFloat(document.getElementById('tp-in').value)}),
    post('/set_sl',     {value:parseFloat(document.getElementById('sl-in').value)}),
    post('/set_amount', {value:parseFloat(document.getElementById('amt-in').value)}),
    post('/set_maxpos', {value:parseInt(document.getElementById('maxpos-in').value)}),
  ]);
  const btn=document.querySelector('.save-btn');
  btn.textContent='âœ“ Saqlandi'; btn.style.color='var(--green)';
  setTimeout(()=>{btn.textContent='Saqlash';btn.style.color='';}, 2000);
  editing=false;
}

async function closePos(sym){
  if(!confirm(sym+' ni yopasizmi?')) return;
  await post('/close_position',{symbol:sym}); update();
}

async function closeAll(){
  if(!confirm('Barcha pozitsiyalarni yopasizmi?')) return;
  await get('/close_all'); update();
}

async function loadHistory(){
  const data = await get('/history');
  const el=document.getElementById('hist-list');
  const tb=document.getElementById('hist-total');
  if(!data||!data.length){
    el.innerHTML='<div class="empty">Hali trade yo\'q</div>';
    tb.style.display='none'; return;
  }
  // Umumiy hisob
  const totalPct  = data.reduce((s,t)=>s+(t.pnl_pct||0),0);
  // Dollar PnL: entry/exit farqi proportsiya bilan taxmin
  const totalUsd  = data.reduce((s,t)=>s+((t.exit-t.entry)/t.entry*(t.pnl_pct/Math.abs(t.pnl_pct||1))*10||0),0);
  const wins      = data.filter(t=>t.pnl_pct>0).length;
  const cls       = totalPct>=0?'g':'r';
  const sign      = totalPct>=0?'+':'';
  tb.style.display='flex';
  document.getElementById('hist-cnt').textContent = data.length+' trade Â· '+wins+' win';
  const hp=document.getElementById('hist-pct');
  hp.textContent=sign+totalPct.toFixed(2)+'%'; hp.className='total-pct '+cls;
  const hu=document.getElementById('hist-usd');
  hu.textContent=(totalUsd>=0?'+':'')+'$'+Math.abs(totalUsd).toFixed(2); hu.className='total-usd '+cls;

  el.innerHTML = data.map(t=>{
    const c=t.pnl_pct>=0?'g':'r';
    const s=t.pnl_pct>=0?'+':'';
    // dollar hisob: entry â†’ exit qiymat o'zgarishi
    const usdChg = (t.exit - t.entry) / t.entry * 10; // taxminiy $10 bazida
    return `<div class="hist-item">
      <div class="hist-led ${c}"></div>
      <div class="hist-info">
        <div class="hist-sym">${t.symbol}</div>
        <div class="hist-meta">${t.date} ${t.time||''} Â· ${t.hold_min}m Â· ${t.reason}</div>
        <div class="hist-prices">Entry: ${t.entry.toFixed(6)} â†’ Exit: ${t.exit.toFixed(6)}</div>
      </div>
      <div class="hist-right">
        <div class="hist-pct ${c}">${s}${t.pnl_pct.toFixed(2)}%</div>
        <div class="hist-usd ${c}">${usdChg>=0?'+':''}$${Math.abs(usdChg).toFixed(2)}</div>
      </div>
    </div>`;
  }).join('');
}

async function loadFixes(){
  const data = await get('/fixes');
  const el = document.getElementById('fixes-list');
  if(!data||!data.length){
    el.innerHTML='<div class="empty"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>Hali avtomatik to\'g\'irlash yo\'q</div>';
    return;
  }
  const typeLabel = {
    'threshold_up':  'Threshold oshirildi',
    'sl_tp_adjust':  'SL/TP moslantirildi',
  };
  el.innerHTML = data.map(f=>`<div class="fix-item">
    <div class="fix-time">${f.time||''}</div>
    <div class="fix-type">${typeLabel[f.type]||f.type}</div>
    <div class="fix-desc">${f.desc}</div>
  </div>`).join('');
}

function renderPositions(pos){
  const el=document.getElementById('pos-list');
  const tb=document.getElementById('pos-total');
  const cab=document.getElementById('close-all-btn');
  const keys=Object.keys(pos);
  document.getElementById('pos-count').textContent=keys.length;

  if(!keys.length){
    el.innerHTML='<div class="empty"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/></svg>Ochiq pozitsiya yo\'q</div>';
    tb.style.display='none'; cab.style.display='none'; return;
  }

  let totPct=0, totUsd=0;
  keys.forEach(sym=>{
    const p=pos[sym];
    totPct+=p.pnl_pct||0;
    totUsd+=(p.current-p.entry)*p.amount;
  });
  const avgPct=totPct/keys.length;
  const tc=avgPct>=0?'g':'r', ts=avgPct>=0?'+':'';

  tb.style.display='flex'; cab.style.display='block';
  document.getElementById('pos-total-lbl').textContent=keys.length+' pozitsiya';
  const pp=document.getElementById('pos-total-pct');
  pp.textContent=ts+avgPct.toFixed(2)+'%'; pp.className='total-pct '+tc;
  const pu=document.getElementById('pos-total-usd');
  pu.textContent=(totUsd>=0?'+':'')+'$'+Math.abs(totUsd).toFixed(2); pu.className='total-usd '+tc;

  el.innerHTML=keys.map(sym=>{
    const p=pos[sym];
    const c=p.pnl_pct>=0?'g':'r', s=p.pnl_pct>=0?'+':'';
    const range=p.tp-p.sl;
    const prog=range>0?Math.min(100,Math.max(0,(p.current-p.sl)/range*100)):50;
    const barC=p.pnl_pct>=0?'var(--green)':'var(--red)';
    const usd=(p.current-p.entry)*p.amount;
    return `<div class="pos-card">
      <div class="pos-head">
        <div class="pos-sym">${sym.replace('/USDT','')}
          <small>${p.sector} Â· score ${p.score} Â· ${p.hold_min}m</small>
        </div>
        <div class="pnl-chip ${c}">${s}${p.pnl_pct.toFixed(2)}%</div>
        <div class="pnl-usd ${c}" style="margin-left:4px">${(usd>=0?'+':'')+'$'+Math.abs(usd).toFixed(2)}</div>
        <button class="x-btn" onclick="closePos('${sym}')">âœ•</button>
      </div>
      <div class="pos-grid">
        <div class="pg"><div class="pg-lbl">Entry</div><div class="pg-val">${p.entry.toFixed(5)}</div></div>
        <div class="pg"><div class="pg-lbl">Now</div><div class="pg-val">${p.current.toFixed(5)}</div></div>
        <div class="pg"><div class="pg-lbl">TP</div><div class="pg-val g">${p.tp.toFixed(5)}</div></div>
        <div class="pg"><div class="pg-lbl">SL</div><div class="pg-val r">${p.sl.toFixed(5)}</div></div>
      </div>
      <div class="track"><div class="track-fill" style="width:${prog}%;background:${barC}"></div></div>
    </div>`;
  }).join('');
}

function renderSignals(sigs){
  const el=document.getElementById('sig-list');
  if(!sigs||!sigs.length){el.innerHTML='<div class="empty">Signal kutilmoqda...</div>';return;}
  el.innerHTML=sigs.map(s=>`<div class="sig-item">
    <div class="sig-led"></div>
    <div class="sig-sym">${s.symbol}</div>
    <div class="sig-time">${s.time}</div>
    <div class="sig-score">${s.score}/9</div>
  </div>`).join('');
}

function renderSymbols(syms){
  const el=document.getElementById('sym-chips');
  el.innerHTML=(syms||[]).map(s=>`<div class="chip on">${s.replace('/USDT','')}</div>`).join('');
}

function renderLog(lines){
  const el=document.getElementById('log-box');
  if(!lines||!lines.length) return;
  el.innerHTML=lines.map((l,i)=>`<div class="log-line${i===0?' fresh':''}">${l}</div>`).join('');
}

function updateScan(on, cnt, lastSig){
  const orb=document.getElementById('scan-orb');
  const t=document.getElementById('scan-t');
  const s=document.getElementById('scan-s');
  const w=document.getElementById('scan-wave');
  if(!on){
    orb.className='scan-orb-inner'; orb.textContent='â¸';
    t.textContent='Kutish rejimi'; s.textContent='Trading o\'chirilgan';
    w.style.display='none';
  } else {
    orb.className='scan-orb-inner pulsing'; orb.textContent='ğŸ“¡';
    t.textContent=cnt+' coin skanlanmoqda';
    s.textContent=lastSig?'Oxirgi: '+lastSig.symbol+' Â· '+lastSig.time:'Signal izlanmoqda...';
    w.style.display='flex';
  }
}

async function update(){
  try{
    const d=await get('/status');
    if(!d) return;
    const on=d.is_running;

    // Status badge
    const sb=document.getElementById('status-badge');
    sb.className='badge'+(on?' on':'');
    document.getElementById('status-txt').textContent=on?'faol':'off';

    // Action btn
    const ab=document.getElementById('action-btn');
    ab.className='action-btn '+(on?'halt':'go');
    ab.textContent=on?"â–  Tradingni To'xtatish":'â–¶ Tradingni Yoqish';

    // Dry
    const db=document.getElementById('dry-badge');
    db.className='badge'+(d.dry_run?'':' real');
    db.innerHTML='<span class="badge-dot"></span>'+(d.dry_run?'DRY':'REAL');

    // Balance
    document.getElementById('balance').textContent='$'+(d.balance||0).toFixed(2);
    document.getElementById('open-cnt').textContent=Object.keys(d.positions||{}).length;
    document.getElementById('coin-cnt').textContent=d.symbols_count||0;
    document.getElementById('upd-time').textContent=d.last_update||'--:--';

    // PnL pill
    const pnl=d.pnl_today||0;
    const pp=document.getElementById('port-pnl');
    pp.textContent=(pnl>=0?'+':'')+pnl.toFixed(2)+'%';
    pp.className='port-pnl '+(pnl>0?'up':pnl<0?'dn':'neu');

    // Metrics
    document.getElementById('mt-trades').textContent=d.trades_today||0;
    document.getElementById('mt-wins').textContent=d.wins_today||0;
    document.getElementById('mt-loss').textContent=d.losses_today||0;
    const mp=document.getElementById('mt-pnl');
    mp.textContent=(pnl>=0?'+':'')+pnl.toFixed(2)+'%';
    mp.className='metric-val '+(pnl>0?'g':pnl<0?'r':'');

    const sigs=d.last_signals||[];
    updateScan(on, d.symbols_count||0, sigs[0]||null);
    renderPositions(d.positions||{});
    renderSignals(sigs);
    renderSymbols(d.symbols||[]);
    renderLog(d.log_lines||[]);

    // Fixes badge
    const fixes=d.auto_fixes||[];
    if(fixes.length){
      renderFixesList(fixes);
    }

    // Settings
    if(!editing){
      document.getElementById('tp-in').value=d.tp_pct||3;
      document.getElementById('sl-in').value=d.sl_pct||1.5;
      document.getElementById('amt-in').value=d.quote_usdt||10;
      document.getElementById('maxpos-in').value=d.max_positions||10;
    }
  }catch(e){console.warn(e)}
}

function renderFixesList(fixes){
  const el=document.getElementById('fixes-list');
  if(!fixes||!fixes.length) return;
  const typeLabel={'threshold_up':'Threshold oshirildi','sl_tp_adjust':'SL/TP moslantirildi'};
  el.innerHTML=fixes.map(f=>`<div class="fix-item">
    <div class="fix-time">${f.time||''}</div>
    <div class="fix-type">${typeLabel[f.type]||f.type}</div>
    <div class="fix-desc">${f.desc}</div>
  </div>`).join('');
}

['tp-in','sl-in','amt-in','maxpos-in'].forEach(id=>{
  document.getElementById(id).addEventListener('focus',()=>editing=true);
  document.getElementById(id).addEventListener('blur',()=>setTimeout(()=>editing=false,5000));
});

update();
setInterval(update,3000);
</script>
</body>
</html>
